<!-- $Id: goods_info.htm 17126 2010-04-23 10:30:26Z liuhui $ -->
{include file="pageheader.htm"}
{insert_scripts files="../js/utils.js,selectzone.js,colorselector.js"}
<script type="text/javascript" src="../js/calendar.php?lang={$cfg_lang}"></script>
<link href="../js/calendar/calendar.css" rel="stylesheet" type="text/css" />

{if $warning}
<ul style="padding:0; margin: 0; list-style-type:none; color: #CC0000;">
      <li style="border: 1px solid #CC0000; background: #FFFFCC; padding: 10px; margin-bottom: 5px;" >{$warning}</li>
</ul>
{/if}

<!-- start goods form -->
<div class="tab-div">
      <!-- tab bar -->
      <!--div id="tabbar-div">
      <p>
      <span class="tab-front" id="general-tab">{$lang.tab_general}</span>
      <span class="tab-back" id="mix-tab">{$lang.tab_mix}</span>
      <span class="tab-back" id="detail-tab">{$lang.tab_detail}</span>
      <span class="tab-back" id="gallery-tab">{$lang.tab_gallery}</span>
      <span class="tab-back" id="linkgoods-tab">{$lang.tab_linkgoods}</span>
      <span class="tab-back" id="groupgoods-tab">{$lang.tab_groupgoods}</span>
      <span class="tab-back" id="article-tab">{$lang.tab_article}</span>
      </p>
      </div-->

      <!-- tab body -->
      <div id="tabbody-div">
            <form enctype="multipart/form-data" action="" method="post" name="theForm" >
                  <!-- 最大文件限制 -->
                  <input type="hidden" name="MAX_FILE_SIZE" value="2097152" />
                  <!-- 通用信息 -->
                  <table width="90%" id="general-table" align="center">
                        <tr>
                              <td class="label">{$lang.lab_goods_name}</td>
                              <td>
                                    <input type="text" name="goods_name" value="{$goods.goods_name|escape}" style="float:left;color:{$goods_name_color};" size="30" />
                              </td>
                        </tr>
                        <tr>
                              <td class="label">
                                    <a href="javascript:showNotice('noticeGoodsSN');" title="{$lang.form_notice}"><img src="images/notice.gif" width="16" height="16" border="0" alt="{$lang.form_notice}"></a> {$lang.lab_goods_sn} </td>
                              <td><input type="text" name="goods_sn" value="{$goods.goods_sn|escape}" size="20" onblur="checkGoodsSn(this.value,'{$goods.goods_id}')" /><span id="goods_sn_notice"></span><br />
                                    <span class="notice-span" {if $help_open}style="display:block" {else} style="display:none" {/if} id="noticeGoodsSN">{$lang.notice_goods_sn}</span></td>
                        </tr>
                        <tr>
                              <td class="label">简要说明：</td>
                              <td><textarea name="goods_brief">{$goods.goods_brief}</textarea></td>
                        </tr>
                        <tr>
                              <td class="label">{$lang.lab_goods_cat}</td>
                              <td><select name="cat_id" onchange="hideCatDiv()" ><option value="0">{$lang.select_please}</option>{$cat_list}</select>
                                    {if $is_add}
                                    <a href="javascript:void(0)" onclick="rapidCatAdd()" title="{$lang.rapid_add_cat}" class="special">{$lang.rapid_add_cat}</a>
                                    <span id="category_add" style="display:none;">
                                          <input class="text" size="10" name="addedCategoryName" />
                                          <a href="javascript:void(0)" onclick="addCategory()" title="{$lang.button_submit}" class="special" >{$lang.button_submit}</a>
                                          <a href="javascript:void(0)" onclick="return goCatPage()" title="{$lang.category_manage}" class="special" >{$lang.category_manage}</a>
                                          <a href="javascript:void(0)" onclick="hideCatDiv()" title="{$lang.hide}" class="special" ><<</a>
                                    </span>
                                    {/if}
                              </td>
                        </tr>
                        <tr>
                              <td class="label">{$lang.lab_goods_brand}</td>
                              <td><select name="brand_id" onchange="hideBrandDiv()" ><option value="0">{$lang.select_please}{html_options options=$brand_list selected=$goods.brand_id}</select>
                                    {if $is_add}
                                    <a href="javascript:void(0)" title="{$lang.rapid_add_brand}" onclick="rapidBrandAdd()" class="special" >{$lang.rapid_add_brand}</a>
                                    <span id="brand_add" style="display:none;">
                                          <input class="text" size="15" name="addedBrandName" />
                                          <a href="javascript:void(0)" onclick="addBrand()" class="special" >{$lang.button_submit}</a>
                                          <a href="javascript:void(0)" onclick="return goBrandPage()" title="{$lang.brand_manage}" class="special" >{$lang.brand_manage}</a>
                                          <a href="javascript:void(0)" onclick="hideBrandDiv()" title="{$lang.hide}" class="special" ><<</a>
                                    </span>
                                    {/if}
                              </td>
                        </tr>
                        {if $suppliers_exists eq 1}
                        <tr>
                              <td class="label">{$lang.label_suppliers}</td>
                              <td><select name="suppliers_id" id="suppliers_id">
                                          <option value="0">{$lang.suppliers_no}</option>
                                          {html_options options=$suppliers_list_name selected=$goods.suppliers_id}
                              </select></td>
                        </tr>
                        {/if}
                        <tr>
                              <td class="label">{$lang.lab_shop_price}</td>
                              <td><input type="text" name="shop_price" value="{$goods.shop_price}" size="20" onblur="priceSetted()"/>
                                    <input type="button" value="{$lang.compute_by_mp}" onclick="marketPriceSetted()" />
                              </td>
                        </tr>

                        <tr>
                              <td class="label">{$lang.lab_picture}</td>
                              <td>
                                    <input type="file" name="goods_img" size="35" accept="image/*"/>
                                    {if $goods.goods_img}
                                    <a href="goods.php?act=show_image&img_url={$goods.goods_img}" target="_blank"><img src="images/yes.gif" border="0" /></a>
                                    {else}
                                    <img src="images/no.gif" />
                                    {/if}
                                    <br /><input type="text" size="40" value="{$lang.lab_picture_url}" style="color:#aaa;" onfocus="if (this.value == '{$lang.lab_picture_url}'){this.value='http://';this.style.color='#000';}" name="goods_img_url"/>
                              </td>
                        </tr>

                        <!-- 属性与规格 -->
                        {if $goods_type_list}
                        <!--tr>自定义字段
                        <td class="label"><a href="javascript:showNotice('noticeGoodsType');" title="{$lang.form_notice}"><img src="images/notice.gif" width="16" height="16" border="0" alt="{$lang.form_notice}"></a>{$lang.lab_goods_type}</td>
                        <td>
                              <select name="goods_type" onchange="getAttrList({$goods.goods_id})">
                                    <option value="0">{$lang.sel_goods_type}</option>
                                    {$goods_type_list}
                              </select><br />
                              <span class="notice-span" {if $help_open}style="display:block" {else} style="display:none" {/if} id="noticeGoodsType">{$lang.notice_goods_type}</span></td>
                  </tr>
                  <tr>
                        <td id="tbody-goodsAttr" colspan="2" style="padding:0">{$goods_attr_html}</td>
                        </tr-->
                        {/if}

                        <tr>
                              <td class="label">库存数量：</td>
                              <td>
                                    <input type="number" name="goods_number" min="0" value="{$goods.goods_number}"/>
                                    <select name="goods_number_units">
                                          <option {if $goods.goods_number_units eq '瓶'}selected{/if}>瓶</option>
                                          <option {if $goods.goods_number_units eq '盒'}selected{/if}>盒</option>
                                          <option {if $goods.goods_number_units eq '罐'}selected{/if}>罐</option>
                                          <option {if $goods.goods_number_units eq '件'}selected{/if}>件</option>
                                    </select>
                              </td>
                        </tr>
                        <tr>
                              <td class="label">{$lang.lab_warn_number}</td>
                              <td><input type="number" min="0" name="warn_number" value="{$goods.warn_number}" size="20" /></td>
                        </tr>
                        <tr>
                              <td class="label">包装方式：</td>
                              <td>
                                    <select name="packing">
                                          <option {if $goods.packing eq '简装'}selected{/if}>简装</option>
                                          <option {if $goods.packing eq '提袋'}selected{/if}>提袋</option>
                                          <option {if $goods.packing eq '礼盒'}selected{/if}>礼盒</option>
                                    </select>
                              </td>
                        </tr>
                        <tr>
                              <td class="label">保质期：</td>
                              <td><input type="number" style="text-align:center" name="shelflife" value="{$goods.shelflife}" step="12" min="0" max="100" />个月</td>
                        </tr>
                        <tr>
                              <td class="label">净含量：</td>
                              <td>
                                    <input type="number" name="per_unit_number" value="{$goods.per_unit_number}" min="1"/>
                                    <select name="per_number_units" onchange="document.getElementById('every_num_units').innerHTML='&nbsp;&nbsp;'+this.value;" id="per_number_units">
                                          <option {if $goods.per_number_units eq '粒'}selected{/if}>粒</option>
                                          <option {if $goods.per_number_units eq '克'}selected{/if}>克</option>
                                          <option {if $goods.per_number_units eq '片'}selected{/if}>片</option>
                                          <option {if $goods.per_number_units eq '粉'}selected{/if}>粉</option>
                                          <option {if $goods.per_number_units eq '件'}selected{/if}>件</option>
                                    </select>
                              </td>
                        </tr>
                        <tr>
                              <td class="label">总重量：</td>
                              <td><input type="number" min="0" name="goods_weight" value="{$goods.goods_weight_by_unit}" size="20" />
                                    <select name="weight_unit">
                                          {html_options options=$unit_list selected=$weight_unit}
                                    </select>
                              </td>
                        </tr>
                        <tr>
                              <td class="label">每次服用量：</td>
                              <td><input type="number" name="every_num" value="{$goods.every_num}"/><span id="every_num_units">&nbsp;&nbsp; {$goods.per_number_units}</span>
                                    <!--select name="every_num_units" id="every_num_units" onchange="synchro()">
                                          <option {if $goods.every_num_units eq '粒'}selected{/if}>粒</option>
                                          <option {if $goods.every_num_units eq '片'}selected{/if}>片</option>
                                          <option {if $goods.every_num_units eq '克'}selected{/if}>克</option>
                                    </select-->
                              </td>
                        </tr>
                        <tr>
                              <td class="label">每天服用次数：</td>
                              <td><!--input type="number" name="everyday_use" value="{$goods.everyday_use}" min="0" style="text-align:center" step="1" max="100"/-->
                                    <input type="radio" name="everyday_use" id="everyday_use_1" value="1" {if $goods.everyday_use eq 1}checked{/if}/>
                                    <label for="everyday_use_1">1次 </label>
                                    <input type="radio" name="everyday_use" id="everyday_use_2" value="2" {if $goods.everyday_use eq 2}checked{/if}/>
                                    <label for="everyday_use_2">2次 </label>
                                    <input type="radio" name="everyday_use" id="everyday_use_3" value="3" {if $goods.everyday_use eq 3}checked{/if}/>
                                    <label for="everyday_use_3">3次 </label>
                                    <input type="radio" name="everyday_use" id="everyday_use_4" value="4" {if $goods.everyday_use eq 4}checked{/if}/>
                                    <label for="everyday_use_4">4次 </label>
                              </td>
                        </tr>
                        <!--tr>
                        <td class="label">{$lang.lab_goods_brief}</td>
                        <td><textarea name="goods_brief" cols="40" rows="3">{$goods.goods_brief|escape}</textarea></td>
                  </tr>
                  <tr>
                        <td class="label">
                              <a href="javascript:showNotice('noticeSellerNote');" title="{$lang.form_notice}"><img src="images/notice.gif" width="16" height="16" border="0" alt="{$lang.form_notice}"></a> {$lang.lab_seller_note} </td>
                        <td><textarea name="seller_note" cols="40" rows="3">{$goods.seller_note}</textarea><br />
                              <span class="notice-span" {if $help_open}style="display:block" {else} style="display:none" {/if} id="noticeSellerNote">{$lang.notice_seller_note}</span></td>
                        </tr-->
                  </table>

                  <!-- 详细描述 -->
                  <!--table width="90%" id="detail-table" style="display:none">
                        <tr>
                              <td>{$FCKeditor}</td>
                        </tr>
                  </table-->

                  <!-- 其他信息 -->
                  <!--table width="90%" id="mix-table" style="display:none" align="center">
                        {if $code eq ''}
                        <tr>
                              <td class="label">{$lang.lab_goods_weight}</td>
                              <td><input type="text" name="goods_weight" value="{$goods.goods_weight_by_unit}" size="20" /> <select name="weight_unit">{html_options options=$unit_list selected=$weight_unit}</select></td>
                        </tr>
                        {/if}
                        <tr>
                              <td class="label">{$lang.lab_warn_number}</td>
                              <td><input type="text" name="warn_number" value="{$goods.warn_number}" size="20" /></td>
                        </tr>
                        <tr>
                              <td class="label">{$lang.lab_keywords}</td>
                              <td><input type="text" name="keywords" value="{$goods.keywords|escape}" size="40" /> {$lang.notice_keywords}</td>
                        </tr>
                        <tr>
                              <td class="label">{$lang.lab_goods_brief}</td>
                              <td><textarea name="goods_brief" cols="40" rows="3">{$goods.goods_brief|escape}</textarea></td>
                        </tr>
                        <tr>
                              <td class="label">
                                    <a href="javascript:showNotice('noticeSellerNote');" title="{$lang.form_notice}"><img src="images/notice.gif" width="16" height="16" border="0" alt="{$lang.form_notice}"></a> {$lang.lab_seller_note} </td>
                              <td><textarea name="seller_note" cols="40" rows="3">{$goods.seller_note}</textarea><br />
                                    <span class="notice-span" {if $help_open}style="display:block" {else} style="display:none" {/if} id="noticeSellerNote">{$lang.notice_seller_note}</span></td>
                        </tr>
                  </table-->



                  <!-- 卫/国食健字 -->
                  <!--table width="90%" id="gallery-table" style="display:none" align="center">
                        <tr>
                              <td class="label">
                                    主要原料：
                              </td>
                              <td>
                                    <input type="text" name="raw_material" value="">
                              </td>
                        </tr>
                        <tr>
                              <td class="label">标志性成分及含量：</td>
                              <td><input type="text" name="" value=""></td>
                        </tr>
                        <tr>
                              <td class="label">批准文号：</td>
                              <td><input type="text" name="approval_num" value=""></td>
                        </tr>
                        <tr>
                              <td class="label">保健功能：</td>
                              <td><input type="text" name="functions" value=""></td>
                        </tr>
                        <tr>
                              <td class="label">适宜人群：</td>
                              <td><input type="text" name="appropriate" value=""></td>
                        </tr>
                        <tr>
                              <td class="label">不适宜人群：</td>
                              <td><input type="text" name="no_appropriate" value=""></td>
                        </tr>
                        <tr>
                              <td class="label">注意事项：</td>
                              <td><input type="text" name="note" value=""></td>
                        </tr>
                        <tr>
                              <td class="label">生产许可证号：</td>
                              <td><input type="text" name="production_license" value=""></td>
                        </tr>
                        <tr>
                              <td class="label">GMP证号：</td>
                              <td><input type="text" name="gmp" value=""></td>
                        </tr>
                        <tr>
                              <td class="label">产品标准号：</td>
                              <td><input type="text" name="product_standards" value=""></td>
                        </tr>
                        <tr>
                              <td class="label">生产厂家：</td>
                              <td><input type="text" name="manufacturer" value=""></td>
                        </tr>
                        <tr>
                              <td class="label">产地：</td>
                              <td><input type="text" name="place_origin" value=""></td>
                        </tr>
                        <tr>
                              <td class="label">储藏方法：</td>
                              <td><input type="text" name="storage_method" value=""></td>
                        </tr>
                  </table-->
                  <!-- 食品 -->
                  <!--table width="90%" id="linkgoods-table" style="display:none" align="center">
                        <tr>
                              <td class="label">成分配料表：</td>
                              <td><input type="text" name="ingredients" value=""></td>
                        </tr>
                        <tr>
                              <td class="label">生产许可证编号：</td>
                              <td><input type="text" name="production_license" value=""></td>
                        </tr>
                        <tr>
                              <td class="label">卫生许可证号：</td>
                              <td><input type="text" name="health_permit" value=""></td>
                        </tr>
                        <tr>
                              <td class="label">产品标准号：</td>
                              <td><input type="text" name="product_standards" value=""></td>
                        </tr>
                        <tr>
                              <td class="label">生产厂家：</td>
                              <td><input type="text" name="manufacturer" value=""></td>
                        </tr>
                        <tr>
                              <td class="label">产地：</td>
                              <td><input type="text" name="place_origin" value=""></td>
                        </tr>
                        <tr>
                              <td class="label">产品备案号：</td>
                              <td><input type="text" name="product_registration" value=""></td>
                        </tr>
                        <tr>
                              <td class="label">执行标准：</td>
                              <td><input type="text" name="implementation" value=""></td>
                        </tr>
                        <tr>
                              <td class="label">GMP证号：</td>
                              <td><input type="text" name="gmp" value=""></td>
                        </tr>
                        <tr>
                              <td class="label">储藏方法：</td>
                              <td><input type="text" name="storage_method" value=""></td>
                        </tr>
                  </table-->

                  <!-- 进口食品 -->
                  <!--table width="90%" id="groupgoods-table" style="display:none" align="center">
                        <tr><td>进口食品</td></tr>
                  </table-->

                  <!-- 保健用具 -->
                  <!--table width="90%" id="article-table" style="display:none" align="center">
                        <tr><td>保健用具</td></tr>
                  </table-->

                  <!-- 商品相册 ! 图片列表 -->
                  <!--table width="90%" id="gallery-table" style="display:none" align="center">
                        <tr>
                              <td>
                                    {foreach from=$img_list item=img key=i}
                                    <div id="gallery_{$img.img_id}" style="float:left; text-align:center; border: 1px solid #DADADA; margin: 4px; padding:2px;">
                                          <a href="javascript:;" onclick="if (confirm('{$lang.drop_img_confirm}')) dropImg('{$img.img_id}')">[-]</a><br />
                                          <a href="goods.php?act=show_image&img_url={$img.img_url}" target="_blank">
                                                <img src="../{if $img.thumb_url}{$img.thumb_url}{else}{$img.img_url}{/if}" {if $thumb_width neq 0}width="{$thumb_width}"{/if} {if $thumb_height neq 0}height="{$thumb_height}"{/if} border="0" />
                                          </a><br />
                                          <input type="text" value="{$img.img_desc|escape}" size="15" name="old_img_desc[{$img.img_id}]" />
                                    </div>
                                    {/foreach}
                              </td>
                        </tr>
                        <tr><td>&nbsp;</td></tr>
                        ! 上传图片 -
                        <tr>
                              <td>
                                    <a href="javascript:;" onclick="addImg(this)">[+]</a>
                                    {$lang.img_desc} <input type="text" name="img_desc[]" size="20" />
                                    {$lang.img_url} <input type="file" name="img_url[]" />
                                    <input type="text" size="40" value="{$lang.img_file}" style="color:#aaa;" onfocus="if (this.value == '{$lang.img_file}'){this.value='http://';this.style.color='#000';}" name="img_file[]"/>
                              </td>
                        </tr>
                  </table>

                  ! 关联商品 -
                  <table width="90%" id="linkgoods-table" style="display:none" align="center">
                        ! 商品搜索 -
                        <tr>
                              <td colspan="3">
                                    <img src="images/icon_search.gif" width="26" height="22" border="0" alt="SEARCH" />
                                    <select name="cat_id1"><option value="0">{$lang.all_category}{$cat_list}</select>
                                    <select name="brand_id1"><option value="0">{$lang.all_brand}{html_options options=$brand_list}</select>
                                    <input type="text" name="keyword1" />
                                    <input type="button" value="{$lang.button_search}"  class="button"
                                    onclick="searchGoods(sz1, 'cat_id1','brand_id1','keyword1')" />
                              </td>
                        </tr>
                        ! 商品列表 -
                        <tr>
                              <th>{$lang.all_goods}</th>
                              <th>{$lang.handler}</th>
                              <th>{$lang.link_goods}</th>
                        </tr>
                        <tr>
                              <td width="42%">
                                    <select name="source_select1" size="20" style="width:100%" ondblclick="sz1.addItem(false, 'add_link_goods', goodsId, this.form.elements['is_single'][0].checked)" multiple="true">
                                    </select>
                              </td>
                              <td align="center">
                                    <p><input name="is_single" type="radio" value="1" checked="checked" />{$lang.single}<br /><input name="is_single" type="radio" value="0" />{$lang.double}</p>
                                    <p><input type="button" value=">>" onclick="sz1.addItem(true, 'add_link_goods', goodsId, this.form.elements['is_single'][0].checked)" class="button" /></p>
                                    <p><input type="button" value=">" onclick="sz1.addItem(false, 'add_link_goods', goodsId, this.form.elements['is_single'][0].checked)" class="button" /></p>
                                    <p><input type="button" value="<" onclick="sz1.dropItem(false, 'drop_link_goods', goodsId, elements['is_single'][0].checked)" class="button" /></p>
                                    <p><input type="button" value="<<" onclick="sz1.dropItem(true, 'drop_link_goods', goodsId, elements['is_single'][0].checked)" class="button" /></p>
                              </td>
                              <td width="42%">
                                    <select name="target_select1" size="20" style="width:100%" multiple ondblclick="sz1.dropItem(false, 'drop_link_goods', goodsId, elements['is_single'][0].checked)">
                                          {foreach from=$link_goods_list item=link_goods}
                                          <option value="{$link_goods.goods_id}">{$link_goods.goods_name}</option>
                                          {/foreach}
                                    </select>
                              </td>
                        </tr>
                  </table>

                  ! 配件 -
                  <table width="90%" id="groupgoods-table" style="display:none" align="center">
                        ! 商品搜索 -
                        <tr>
                              <td colspan="3">
                                    <img src="images/icon_search.gif" width="26" height="22" border="0" alt="SEARCH" />
                                    <select name="cat_id2"><option value="0">{$lang.all_category}{$cat_list}</select>
                                    <select name="brand_id2"><option value="0">{$lang.all_brand}{html_options options=$brand_list}</select>
                                    <input type="text" name="keyword2" />
                                    <input type="button" value="{$lang.button_search}" onclick="searchGoods(sz2, 'cat_id2', 'brand_id2', 'keyword2')" class="button" />
                              </td>
                        </tr>
                        ! 商品列表 -
                        <tr>
                              <th>{$lang.all_goods}</th>
                              <th>{$lang.handler}</th>
                              <th>{$lang.group_goods}</th>
                        </tr>
                        <tr>
                              <td width="42%">
                                    <select name="source_select2" size="20" style="width:100%" onchange="sz2.priceObj.value = this.options[this.selectedIndex].id" ondblclick="sz2.addItem(false, 'add_group_goods', goodsId, this.form.elements['price2'].value)">
                                    </select>
                              </td>
                              <td align="center">
                                    <p>{$lang.price}<br /><input name="price2" type="text" size="6" /></p>
                                    <p><input type="button" value=">" onclick="sz2.addItem(false, 'add_group_goods', goodsId, this.form.elements['price2'].value)" class="button" /></p>
                                    <p><input type="button" value="<" onclick="sz2.dropItem(false, 'drop_group_goods', goodsId, elements['is_single'][0].checked)" class="button" /></p>
                                    <p><input type="button" value="<<" onclick="sz2.dropItem(true, 'drop_group_goods', goodsId, elements['is_single'][0].checked)" class="button" /></p>
                              </td>
                              <td width="42%">
                                    <select name="target_select2" size="20" style="width:100%" multiple ondblclick="sz2.dropItem(false, 'drop_group_goods', goodsId, elements['is_single'][0].checked)">
                                          {foreach from=$group_goods_list item=group_goods}
                                          <option value="{$group_goods.goods_id}">{$group_goods.goods_name}</option>
                                          {/foreach}
                                    </select>
                              </td>
                        </tr>
                  </table>

                  ! 关联文章 -
                  <table width="90%" id="groupgoods-table" style="display:none" align="center">
                        <table width="90%" id="article-table" style="display:none" align="center">
                              ! 文章搜索 -
                              <tr>
                                    <td colspan="3">
                                          <img src="images/icon_search.gif" width="26" height="22" border="0" alt="SEARCH" />
                                          {$lang.article_title} <input type="text" name="article_title" />
                                          <input type="button" value="{$lang.button_search}" onclick="searchArticle()" class="button" />
                                    </td>
                              </tr>
                              ! 文章列表 -
                              <tr>
                                    <th>{$lang.all_article}</th>
                                    <th>{$lang.handler}</th>
                                    <th>{$lang.goods_article}</th>
                              </tr>
                              <tr>
                                    <td width="45%">
                                          <select name="source_select3" size="20" style="width:100%" multiple ondblclick="sz3.addItem(false, 'add_goods_article', goodsId, this.form.elements['price2'].value)">
                                          </select>
                                    </td>
                                    <td align="center">
                                          <p><input type="button" value=">>" onclick="sz3.addItem(true, 'add_goods_article', goodsId, this.form.elements['price2'].value)" class="button" /></p>
                                          <p><input type="button" value=">" onclick="sz3.addItem(false, 'add_goods_article', goodsId, this.form.elements['price2'].value)" class="button" /></p>
                                          <p><input type="button" value="<" onclick="sz3.dropItem(false, 'drop_goods_article', goodsId, elements['is_single'][0].checked)" class="button" /></p>
                                          <p><input type="button" value="<<" onclick="sz3.dropItem(true, 'drop_goods_article', goodsId, elements['is_single'][0].checked)" class="button" /></p>
                                    </td>
                                    <td width="45%">
                                          <select name="target_select3" size="20" style="width:100%" multiple ondblclick="sz3.dropItem(false, 'drop_goods_article', goodsId, elements['is_single'][0].checked)">
                                                {foreach from=$goods_article_list item=goods_article}
                                                <option value="{$goods_article.article_id}">{$goods_article.title}</option>
                                                {/foreach}
                                          </select>
                                    </td>
                              </tr>
                        </table>
                        -->
                        <div class="button-div">
                              <input type="hidden" name="goods_id" value="{$goods.goods_id}" />
                              {if $code neq ''}
                              <input type="hidden" name="extension_code" value="{$code}" />
                              {/if}
                              <input type="button" value="{$lang.button_submit}" class="button" onclick="validate('{$goods.goods_id}')" />
                              <input type="reset" value="{$lang.button_reset}" class="button" />
                        </div>
                        <input type="hidden" name="act" value="{$form_act}" />
                  </form>
            </div>
      </div>
      <!-- end goods form -->
      {insert_scripts files="validator.js,tab.js"}

      <script language="JavaScript">
            var goodsId = '{$goods.goods_id}';
            var elements = document.forms['theForm'].elements;
            var sz1 = new SelectZone(1, elements['source_select1'], elements['target_select1']);
            var sz2 = new SelectZone(2, elements['source_select2'], elements['target_select2'], elements['price2']);
            var sz3 = new SelectZone(1, elements['source_select3'], elements['target_select3']);
            var marketPriceRate = {$cfg.market_price_rate|default:1};
            var integralPercent = {$cfg.integral_percent|default:0};

            {literal}
            onload = function()
            {
                  handlePromote(document.forms['theForm'].elements['is_promote'].checked);

                  if (document.forms['theForm'].elements['auto_thumb'])
                  {
                        handleAutoThumb(document.forms['theForm'].elements['auto_thumb'].checked);
                  }

                  // 检查新订单
                  startCheckOrder();
                  {/literal}
                  {foreach from=$user_rank_list item=item}
                  set_price_note({$item.rank_id});
                  {/foreach}
                  {literal}
                  document.forms['theForm'].reset();
            }

            function validate(goods_id)
            {
                  var validator = new Validator('theForm');
                  var goods_sn  = document.forms['theForm'].elements['goods_sn'].value;

                  validator.required('goods_name', goods_name_not_null);
                  if (document.forms['theForm'].elements['cat_id'].value == 0)
                  {
                        validator.addErrorMsg(goods_cat_not_null);
                  }

                  checkVolumeData("1",validator);

                  validator.required('shop_price', shop_price_not_null);
                  validator.isNumber('shop_price', shop_price_not_number, true);

                  if (document.forms['theForm'].elements['goods_number'] != undefined)
                  {
                        validator.isInt('goods_number', goods_number_not_int, false);
                        validator.isInt('warn_number', warn_number_not_int, false);
                  }

                  var callback = function(res)
                  {
                        if (res.error > 0)
                        {
                              alert("{$lang.goods_sn_exists}");
                        }
                        else
                        {
                              if(validator.passed())
                              {
                                    document.forms['theForm'].submit();
                              }
                        }
                  }

                  Ajax.call('goods.php?is_ajax=1&act=check_goods_sn', "goods_sn=" + goods_sn + "&goods_id=" + goods_id, callback, "GET", "JSON");
            }

            /**
            * 切换商品类型
            */
            function getAttrList(goodsId)
            {
                  var selGoodsType = document.forms['theForm'].elements['goods_type'];

                  if (selGoodsType != undefined)
                  {
                        var goodsType = selGoodsType.options[selGoodsType.selectedIndex].value;

                        Ajax.call('goods.php?is_ajax=1&act=get_attr', 'goods_id=' + goodsId + "&goods_type=" + goodsType, setAttrList, "GET", "JSON");
                  }
            }

            function setAttrList(result, text_result)
            {
                  document.getElementById('tbody-goodsAttr').innerHTML = result.content;
            }

            /**
            * 按比例计算价格
            * @param   string  inputName   输入框名称
            * @param   float   rate        比例
            * @param   string  priceName   价格
            */
            function computePrice(inputName, rate, priceName)
            {
                  var shopPrice = priceName == undefined ? document.forms['theForm'].elements['shop_price'].value : document.forms['theForm'].elements[priceName].value;
                  shopPrice = Utils.trim(shopPrice) != '' ? parseFloat(shopPrice)* rate : 0;
                  if(inputName == 'integral')
                  {
                        shopPrice = parseInt(shopPrice);
                  }
                  shopPrice += "";

                  n = shopPrice.lastIndexOf(".");
                  if (n > -1)
                  {
                        shopPrice = shopPrice.substr(0, n + 3);
                  }

                  if (document.forms['theForm'].elements[inputName] != undefined)
                  {
                        document.forms['theForm'].elements[inputName].value = shopPrice;
                  }
                  else
                  {
                        document.getElementById(inputName).value = shopPrice;
                  }
            }

            /**
            * 设置了一个商品价格，改变市场价格、积分以及会员价格
            */
            function priceSetted()
            {
                  computePrice('market_price', marketPriceRate);
                  computePrice('integral', integralPercent / 100);
                  {/literal}
                  {foreach from=$user_rank_list item=item}
                  set_price_note({$item.rank_id});
                  {/foreach}
                  {literal}
            }

            /**
            * 设置会员价格注释
            */
            function set_price_note(rank_id)
            {
                  var shop_price = parseFloat(document.forms['theForm'].elements['shop_price'].value);

                  var rank = new Array();
                  {/literal}
                  {foreach from=$user_rank_list item=item}
                  rank[{$item.rank_id}] = {$item.discount|default:100};
                  {/foreach}
                  {literal}
                  if (shop_price >0 && rank[rank_id] && document.getElementById('rank_' + rank_id) && parseInt(document.getElementById('rank_' + rank_id).value) == -1)
                  {
                        var price = parseInt(shop_price * rank[rank_id] + 0.5) / 100;
                        if (document.getElementById('nrank_' + rank_id))
                        {
                              document.getElementById('nrank_' + rank_id).innerHTML = '(' + price + ')';
                        }
                  }
                  else
                  {
                        if (document.getElementById('nrank_' + rank_id))
                        {
                              document.getElementById('nrank_' + rank_id).innerHTML = '';
                        }
                  }
            }

            /**
            * 根据市场价格，计算并改变商店价格、积分以及会员价格
            */
            function marketPriceSetted()
            {
                  computePrice('shop_price', 1/marketPriceRate, 'market_price');
                  computePrice('integral', integralPercent / 100);
                  {/literal}
                  {foreach from=$user_rank_list item=item}
                  set_price_note({$item.rank_id});
                  {/foreach}
                  {literal}
            }

            /**
            * 新增一个规格
            */
            function addSpec(obj)
            {
                  var src   = obj.parentNode.parentNode;
                  var idx   = rowindex(src);
                  var tbl   = document.getElementById('attrTable');
                  var row   = tbl.insertRow(idx + 1);
                  var cell1 = row.insertCell(-1);
                  var cell2 = row.insertCell(-1);
                  var regx  = /<a([^>]+)<\/a>/i;

                        cell1.className = 'label';
                        cell1.innerHTML = src.childNodes[0].innerHTML.replace(/(.*)(addSpec)(.*)(\[)(\+)/i, "$1removeSpec$3$4-");
                        cell2.innerHTML = src.childNodes[1].innerHTML.replace(/readOnly([^\s|>]*)/i, '');
                  }

                  /**
                  * 删除规格值
                  */
                  function removeSpec(obj)
                  {
                        var row = rowindex(obj.parentNode.parentNode);
                        var tbl = document.getElementById('attrTable');

                        tbl.deleteRow(row);
                  }

                  /**
                  * 处理规格
                  */
                  function handleSpec()
                  {
                        var elementCount = document.forms['theForm'].elements.length;
                        for (var i = 0; i < elementCount; i++)
                        {
                              var element = document.forms['theForm'].elements[i];
                              if (element.id.substr(0, 5) == 'spec_')
                              {
                                    var optCount = element.options.length;
                                    var value = new Array(optCount);
                                    for (var j = 0; j < optCount; j++)
                                    {
                                          value[j] = element.options[j].value;
                                    }

                                    var hiddenSpec = document.getElementById('hidden_' + element.id);
                                    // 用回车键隔开每个规格
                                    hiddenSpec.value = value.join(String.fromCharCode(13)); 
                              }
                        }
                        return true;
                  }

                  function handlePromote(checked)
                  {
                        document.forms['theForm'].elements['promote_price'].disabled = !checked;
                        document.forms['theForm'].elements['selbtn1'].disabled = !checked;
                        document.forms['theForm'].elements['selbtn2'].disabled = !checked;
                  }

                  function handleAutoThumb(checked)
                  {
                        document.forms['theForm'].elements['goods_thumb'].disabled = checked;
                        document.forms['theForm'].elements['goods_thumb_url'].disabled = checked;
                  }

                  /**
                  * 快速添加品牌
                  */
                  function rapidBrandAdd(conObj)
                  {
                        var brand_div = document.getElementById("brand_add");

                        if(brand_div.style.display != '')
                        {
                              var brand =document.forms['theForm'].elements['addedBrandName'];
                              brand.value = '';
                              brand_div.style.display = '';
                        }
                  }

                  function hideBrandDiv()
                  {
                        var brand_add_div = document.getElementById("brand_add");
                        if(brand_add_div.style.display != 'none')
                        {
                              brand_add_div.style.display = 'none';
                        }
                  }

                  function goBrandPage()
                  {
                        if(confirm(go_brand_page))
                        {
                              window.location.href='brand.php?act=add';
                        }
                        else
                        {
                              return;
                        }
                  }

                  function rapidCatAdd()
                  {
                        var cat_div = document.getElementById("category_add");

                        if(cat_div.style.display != '')
                        {
                              var cat =document.forms['theForm'].elements['addedCategoryName'];
                              cat.value = '';
                              cat_div.style.display = '';
                        }
                  }

                  function addBrand()
                  {
                        var brand = document.forms['theForm'].elements['addedBrandName'];
                        if(brand.value.replace(/^\s+|\s+$/g, '') == '')
                        {
                              alert(brand_cat_not_null);
                              return;
                        }

                        var params = 'brand=' + brand.value;
                        Ajax.call('brand.php?is_ajax=1&act=add_brand', params, addBrandResponse, 'GET', 'JSON');
                  }

                  function addBrandResponse(result)
                  {
                        if (result.error == '1' && result.message != '')
                        {
                              alert(result.message);
                              return;
                        }

                        var brand_div = document.getElementById("brand_add");
                        brand_div.style.display = 'none';

                        var response = result.content;

                        var selCat = document.forms['theForm'].elements['brand_id'];
                        var opt = document.createElement("OPTION");
                        opt.value = response.id;
                        opt.selected = true;
                        opt.text = response.brand;

                        if (Browser.isIE)
                        {
                              selCat.add(opt);
                        }
                        else
                        {
                              selCat.appendChild(opt);
                        }

                        return;
                  }

                  function addCategory()
                  {
                        var parent_id = document.forms['theForm'].elements['cat_id'];
                        var cat = document.forms['theForm'].elements['addedCategoryName'];
                        if(cat.value.replace(/^\s+|\s+$/g, '') == '')
                        {
                              alert(category_cat_not_null);
                              return;
                        }

                        var params = 'parent_id=' + parent_id.value;
                        params += '&cat=' + cat.value;
                        Ajax.call('category.php?is_ajax=1&act=add_category', params, addCatResponse, 'GET', 'JSON');
                  }

                  function hideCatDiv()
                  {
                        var category_add_div = document.getElementById("category_add");
                        if(category_add_div.style.display != null)
                        {
                              category_add_div.style.display = 'none';
                        }
                  }

                  function addCatResponse(result)
                  {
                        if (result.error == '1' && result.message != '')
                        {
                              alert(result.message);
                              return;
                        }

                        var category_add_div = document.getElementById("category_add");
                        category_add_div.style.display = 'none';

                        var response = result.content;

                        var selCat = document.forms['theForm'].elements['cat_id'];
                        var opt = document.createElement("OPTION");
                        opt.value = response.id;
                        opt.selected = true;
                        opt.innerHTML = response.cat;

                        // 获取子分类的空格数
                        var str = selCat.options[selCat.selectedIndex].text;
                        var temp = str.replace(/^\s+/g, '');
                        var lengOfSpace = str.length - temp.length;
                        if(response.parent_id != 0)
                        {
                              lengOfSpace += 4;
                        }
                        for (i = 0; i < lengOfSpace; i++)
                        {
                              opt.innerHTML = '&nbsp;' + opt.innerHTML;
                        }

                        for (i = 0; i < selCat.length; i++)
                        {
                              if(selCat.options[i].value == response.parent_id)
                              {
                                    if(i == selCat.length)
                                    {
                                          if (Browser.isIE)
                                          {
                                                selCat.add(opt);
                                          }
                                          else
                                          {
                                                selCat.appendChild(opt);
                                          }
                                    }
                                    else
                                    {
                                          selCat.insertBefore(opt, selCat.options[i + 1]);
                                    }
                                    //opt.selected = true;
                                    break;
                              }

                        }

                        return;
                  }

                  function goCatPage()
                  {
                        if(confirm(go_category_page))
                        {
                              window.location.href='category.php?act=add';
                        }
                        else
                        {
                              return;
                        }
                  }


                  /**
                  * 删除快速分类
                  */
                  function removeCat()
                  {
                        if(!document.forms['theForm'].elements['parent_cat'] || !document.forms['theForm'].elements['new_cat_name'])
                        {
                              return;
                        }

                        var cat_select = document.forms['theForm'].elements['parent_cat'];
                        var cat = document.forms['theForm'].elements['new_cat_name'];

                        cat.parentNode.removeChild(cat);
                        cat_select.parentNode.removeChild(cat_select);
                  }

                  /**
                  * 删除快速品牌
                  */
                  function removeBrand()
                  {
                        if (!document.forms['theForm'].elements['new_brand_name'])
                        {
                              return;
                        }

                        var brand = document.theForm.new_brand_name;
                        brand.parentNode.removeChild(brand);
                  }

                  /**
                  * 添加扩展分类
                  */
                  function addOtherCat(conObj)
                  {
                        var sel = document.createElement("SELECT");
                        var selCat = document.forms['theForm'].elements['cat_id'];

                        for (i = 0; i < selCat.length; i++)
                        {
                              var opt = document.createElement("OPTION");
                              opt.text = selCat.options[i].text;
                              opt.value = selCat.options[i].value;
                              if (Browser.isIE)
                              {
                                    sel.add(opt);
                              }
                              else
                              {
                                    sel.appendChild(opt);
                              }
                        }
                        conObj.appendChild(sel);
                        sel.name = "other_cat[]";
                        sel.onChange = function() {checkIsLeaf(this);};
                  }

                  /* 关联商品函数 */
                  function searchGoods(szObject, catId, brandId, keyword)
                  {
                        var filters = new Object;

                        filters.cat_id = elements[catId].value;
                        filters.brand_id = elements[brandId].value;
                        filters.keyword = Utils.trim(elements[keyword].value);
                        filters.exclude = document.forms['theForm'].elements['goods_id'].value;

                        szObject.loadOptions('get_goods_list', filters);
                  }

                  /**
                  * 关联文章函数
                  */
                  function searchArticle()
                  {
                        var filters = new Object;

                        filters.title = Utils.trim(elements['article_title'].value);

                        sz3.loadOptions('get_article_list', filters);
                  }

                  /**
                  * 新增一个图片
                  */
                  function addImg(obj)
                  {
                        var src  = obj.parentNode.parentNode;
                        var idx  = rowindex(src);
                        var tbl  = document.getElementById('gallery-table');
                        var row  = tbl.insertRow(idx + 1);
                        var cell = row.insertCell(-1);
                        cell.innerHTML = src.cells[0].innerHTML.replace(/(.*)(addImg)(.*)(\[)(\+)/i, "$1removeImg$3$4-");
                  }

                  /**
                  * 删除图片上传
                  */
                  function removeImg(obj)
                  {
                        var row = rowindex(obj.parentNode.parentNode);
                        var tbl = document.getElementById('gallery-table');

                        tbl.deleteRow(row);
                  }

                  /**
                  * 删除图片
                  */
                  function dropImg(imgId)
                  {
                        Ajax.call('goods.php?is_ajax=1&act=drop_image', "img_id="+imgId, dropImgResponse, "GET", "JSON");
                  }

                  function dropImgResponse(result)
                  {
                        if (result.error == 0)
                        {
                              document.getElementById('gallery_' + result.content).style.display = 'none';
                        }
                  }

                  /**
                  * 将市场价格取整
                  */
                  function integral_market_price()
                  {
                        document.forms['theForm'].elements['market_price'].value = parseInt(document.forms['theForm'].elements['market_price'].value);
                  }

                  /**
                  * 将积分购买额度取整
                  */
                  function parseint_integral()
                  {
                        document.forms['theForm'].elements['integral'].value = parseInt(document.forms['theForm'].elements['integral'].value);
                  }


                  /**
                  * 检查货号是否存在
                  */
                  function checkGoodsSn(goods_sn, goods_id)
                  {
                        if (goods_sn == '')
                        {
                              document.getElementById('goods_sn_notice').innerHTML = "";
                              return;
                        }

                        var callback = function(res)
                        {
                              if (res.error > 0)
                              {
                                    document.getElementById('goods_sn_notice').innerHTML = res.message;
                                    document.getElementById('goods_sn_notice').style.color = "red";
                              }
                              else
                              {
                                    document.getElementById('goods_sn_notice').innerHTML = "";
                              }
                        }
                        Ajax.call('goods.php?is_ajax=1&act=check_goods_sn', "goods_sn=" + goods_sn + "&goods_id=" + goods_id, callback, "GET", "JSON");
                  }

                  /**
                  * 新增一个优惠价格
                  */
                  function addVolumePrice(obj)
                  {
                        var src      = obj.parentNode.parentNode;
                        var tbl      = document.getElementById('tbody-volume');

                        var validator  = new Validator('theForm');
                        checkVolumeData("0",validator);
                        if (!validator.passed())
                        {
                              return false;
                        }

                        var row  = tbl.insertRow(tbl.rows.length);
                        var cell = row.insertCell(-1);
                        cell.innerHTML = src.cells[0].innerHTML.replace(/(.*)(addVolumePrice)(.*)(\[)(\+)/i, "$1removeVolumePrice$3$4-");

                        var number_list = document.getElementsByName("volume_number[]");
                        var price_list  = document.getElementsByName("volume_price[]");

                        number_list[number_list.length-1].value = "";
                        price_list[price_list.length-1].value   = "";
                  }

                  /**
                  * 删除优惠价格
                  */
                  function removeVolumePrice(obj)
                  {
                        var row = rowindex(obj.parentNode.parentNode);
                        var tbl = document.getElementById('tbody-volume');

                        tbl.deleteRow(row);
                  }

                  /**
                  * 校验优惠数据是否正确
                  */
                  function checkVolumeData(isSubmit,validator)
                  {
                        var volumeNum = document.getElementsByName("volume_number[]");
                        var volumePri = document.getElementsByName("volume_price[]");
                        var numErrNum = 0;
                        var priErrNum = 0;

                        for (i = 0 ; i < volumePri.length ; i ++)
                        {
                              if ((isSubmit != 1 || volumeNum.length > 1) && numErrNum <= 0 && volumeNum.item(i).value == "")
                              {
                                    validator.addErrorMsg(volume_num_not_null);
                                    numErrNum++;
                              }

                              if (numErrNum <= 0 && Utils.trim(volumeNum.item(i).value) != "" && ! Utils.isNumber(Utils.trim(volumeNum.item(i).value)))
                              {
                                    validator.addErrorMsg(volume_num_not_number);
                                    numErrNum++;
                              }

                              if ((isSubmit != 1 || volumePri.length > 1) && priErrNum <= 0 && volumePri.item(i).value == "")
                              {
                                    validator.addErrorMsg(volume_price_not_null);
                                    priErrNum++;
                              }

                              if (priErrNum <= 0 && Utils.trim(volumePri.item(i).value) != "" && ! Utils.isNumber(Utils.trim(volumePri.item(i).value)))
                              {
                                    validator.addErrorMsg(volume_price_not_number);
                                    priErrNum++;
                              }
                        }
                  }

                  {/literal}
            </script>
            {include file="pagefooter.htm"}

